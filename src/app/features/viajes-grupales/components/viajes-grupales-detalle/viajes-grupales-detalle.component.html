@if (isLoading) {
  <div class="flex items-center justify-center min-h-screen bg-slate-50">
    <div class="text-center">
      <mat-spinner [diameter]="config.detail.loading.spinnerDiameter" [strokeWidth]="config.detail.loading.spinnerStrokeWidth" class="mx-auto"></mat-spinner>
      <p class="mt-6 text-gray-500 font-medium animate-pulse">{{ config.detail.loading.message }}</p>
    </div>
  </div>
} @else if (viaje) {
  <div class="w-full min-h-screen bg-white flex flex-col items-center">
    <div class="w-full max-w-7xl mx-auto mt-8 sm:mt-12 lg:mt-16 mb-12 sm:mb-16 px-4 sm:px-6">
      <div class="w-full">
        <div class="flex flex-col lg:flex-row w-full lg:items-start">
          
          <!-- Imagen a la izquierda (Columna Visual) -->
          <div class="w-full lg:w-[45%] lg:flex-shrink-0 lg:flex-grow-0 lg:max-w-[45%] p-4 sm:p-6 lg:p-8 lg:sticky lg:top-8 lg:self-start">
            <div class="w-full aspect-[5/4] overflow-hidden relative mb-6">
              <img 
                [src]="viaje.imagenUrl || 'assets/images/placeholder-destination.jpg'" 
                [alt]="viaje.nombre" 
                class="w-full h-full object-cover"
              />
            </div>

            <!-- Cards de Info (Precio y Fecha) -->
            <div class="grid grid-cols-1 gap-4">
              <!-- Fechas -->
              @if (viaje.fechaInicio && viaje.fechaFin) {
                <div class="flex items-center gap-4 p-4 rounded-2xl bg-blue-100/70 border border-blue-200/70 shadow-sm">
                  <div class="w-12 h-12 rounded-full bg-blue-200 flex items-center justify-center flex-shrink-0 text-blue-700">
                    <mat-icon>{{ config.detail.content.sections.dates.icon }}</mat-icon>
                  </div>
                  <div>
                    <p class="text-xs font-bold text-blue-700 uppercase tracking-wide mb-0.5">{{ config.detail.content.sections.dates.label }}</p>
                    <p class="text-base font-bold text-slate-900 leading-tight">
                      {{ formatearRangoFechas(viaje.fechaInicio, viaje.fechaFin) }}
                    </p>
                  </div>
                </div>
              }
              <!-- Precio -->
              @if (viaje.valor) {
                <div class="flex items-center gap-4 p-4 rounded-2xl bg-emerald-100/70 border border-emerald-200/70 shadow-sm">
                  <div class="w-12 h-12 rounded-full bg-emerald-200 flex items-center justify-center flex-shrink-0 text-emerald-700">
                    <mat-icon>{{ config.detail.content.sections.price.icon }}</mat-icon>
                  </div>
                  <div>
                    <p class="text-xs font-bold text-emerald-700 uppercase tracking-wide mb-0.5">{{ config.detail.content.sections.price.label }}</p>
                    <p class="text-xl font-bold text-slate-900">
                      {{ formatearPrecio(viaje.valor) }}
                    </p>
                  </div>
                </div>
              }

            </div>
          </div>

          <!-- Contenido a la derecha (Columna Info) -->
          <div class="w-full lg:w-[55%] flex flex-col p-6 lg:p-10 pt-4 lg:pt-10">
            
            <!-- Header -->
            <div class="mb-[15px]">
              <div class="flex items-center gap-3 mb-[7px]">
                <span class="text-amber-500 text-2xl lg:text-3xl font-bold uppercase tracking-wider">
                  {{ config.detail.content.prefixTitle }}
                </span>
              </div>
              
              <mat-card-title class="viaje-title font-serif font-extrabold text-slate-900 !mb-2 !leading-tight tracking-tight" style="font-size: 2.7rem; line-height: 1.1;">
                {{ viaje.nombre }}
              </mat-card-title>
            </div>

            <!-- DescripciÃ³n -->
            <mat-card-content class="!p-0 mb-2">
              <p class="text-lg lg:text-xl text-slate-600 leading-loose font-normal">
                {{ viaje.descripcion }}
              </p>
            </mat-card-content>

            <mat-divider class="!mb-6 !border-gray-100"></mat-divider>

            <!-- Acordeones Modernos -->
            <div class="mb-10 flex flex-col gap-3">
              <!-- Incluye -->
              @if (viaje.incluye) {
                <div class="group rounded-2xl overflow-hidden bg-white hover:bg-white shadow-sm border border-slate-200/50 transition-colors duration-500 ease-in-out">
                  <button 
                    (click)="toggleIncluye()"
                    class="w-full flex items-center justify-between p-5 text-left focus:outline-none">
                    <div class="flex items-center gap-4">
                      <div class="w-8 h-8 rounded-full bg-white flex items-center justify-center shadow-sm text-amber-600">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                      </div>
                      <span class="font-bold text-slate-800 text-lg">{{ config.detail.content.sections.includes.title }}</span>
                    </div>
                    <div class="w-8 h-8 rounded-full bg-white/50 flex items-center justify-center transition-all duration-500 ease-in-out"
                         [class.rotate-180]="isIncluyeExpanded"
                         [class.bg-white]="isIncluyeExpanded">
                      <svg class="w-5 h-5 text-slate-400 transition-colors duration-500 ease-in-out" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                      </svg>
                    </div>
                  </button>
                  <div 
                    class="overflow-hidden transition-all ease-in-out origin-top"
                    [class.duration-200]="!isIncluyeExpanded"
                    [class.duration-500]="isIncluyeExpanded"
                    [class.max-h-0]="!isIncluyeExpanded"
                    [class.max-h-[2000px]]="isIncluyeExpanded">
                    <div class="p-5 pt-0 pl-[4.5rem] text-slate-600 leading-relaxed transition-opacity ease-in-out" 
                         [class.duration-200]="!isIncluyeExpanded"
                         [class.duration-500]="isIncluyeExpanded"
                         [class.opacity-0]="!isIncluyeExpanded"
                         [class.opacity-100]="isIncluyeExpanded"
                         [innerHTML]="getIncluyeHtml()"></div>
                  </div>
                </div>
              }

              <!-- No Incluye -->
              @if (viaje.noIncluye) {
                <div class="group rounded-2xl overflow-hidden bg-white hover:bg-white shadow-sm border border-slate-200/50 transition-colors duration-500 ease-in-out">
                  <button 
                    (click)="toggleNoIncluye()"
                    class="w-full flex items-center justify-between p-5 text-left focus:outline-none">
                    <div class="flex items-center gap-4">
                      <div class="w-8 h-8 rounded-full bg-white flex items-center justify-center shadow-sm text-slate-400">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                      </div>
                      <span class="font-bold text-slate-800 text-lg">{{ config.detail.content.sections.excludes.title }}</span>
                    </div>
                    <div class="w-8 h-8 rounded-full bg-white/50 flex items-center justify-center transition-all duration-500 ease-in-out"
                         [class.rotate-180]="isNoIncluyeExpanded"
                         [class.bg-white]="isNoIncluyeExpanded">
                      <svg class="w-5 h-5 text-slate-400 transition-colors duration-500 ease-in-out" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                      </svg>
                    </div>
                  </button>
                  <div 
                    class="overflow-hidden transition-all ease-in-out origin-top"
                    [class.duration-200]="!isNoIncluyeExpanded"
                    [class.duration-500]="isNoIncluyeExpanded"
                    [class.max-h-0]="!isNoIncluyeExpanded"
                    [class.max-h-[2000px]]="isNoIncluyeExpanded">
                    <div class="p-5 pt-0 pl-[4.5rem] text-slate-600 leading-relaxed transition-opacity ease-in-out" 
                         [class.duration-200]="!isNoIncluyeExpanded"
                         [class.duration-500]="isNoIncluyeExpanded"
                         [class.opacity-0]="!isNoIncluyeExpanded"
                         [class.opacity-100]="isNoIncluyeExpanded"
                         [innerHTML]="getNoIncluyeHtml()"></div>
                  </div>
                </div>
              }

              <!-- Itinerario -->
              @if (viaje.itinerario) {
                <div class="group rounded-2xl overflow-hidden bg-white hover:bg-white shadow-sm border border-slate-200/50 transition-colors duration-500 ease-in-out">
                  <button 
                    (click)="toggleItinerario()"
                    class="w-full flex items-center justify-between p-5 text-left focus:outline-none">
                    <div class="flex items-center gap-4">
                      <div class="w-8 h-8 rounded-full bg-white flex items-center justify-center shadow-sm text-blue-500">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"></path></svg>
                      </div>
                      <span class="font-bold text-slate-800 text-lg">{{ config.detail.content.sections.itinerary.title }}</span>
                    </div>
                    <div class="w-8 h-8 rounded-full bg-white/50 flex items-center justify-center transition-all duration-500 ease-in-out"
                         [class.rotate-180]="isItinerarioExpanded"
                         [class.bg-white]="isItinerarioExpanded">
                      <svg class="w-5 h-5 text-slate-400 transition-colors duration-500 ease-in-out" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                      </svg>
                    </div>
                  </button>
                  <div 
                    class="overflow-hidden transition-all ease-in-out origin-top"
                    [class.duration-200]="!isItinerarioExpanded"
                    [class.duration-500]="isItinerarioExpanded"
                    [class.max-h-0]="!isItinerarioExpanded"
                    [class.max-h-[2000px]]="isItinerarioExpanded">
                    <div class="p-5 pt-0 pl-[4.5rem] text-slate-600 leading-relaxed transition-opacity ease-in-out" 
                         [class.duration-200]="!isItinerarioExpanded"
                         [class.duration-500]="isItinerarioExpanded"
                         [class.opacity-0]="!isItinerarioExpanded"
                         [class.opacity-100]="isItinerarioExpanded"
                         [innerHTML]="getItinerarioHtml()"></div>
                  </div>
                </div>
              }

              <!-- Sugerencias -->
              @if (viaje.sugerencias) {
                <div class="group rounded-2xl overflow-hidden bg-white hover:bg-white shadow-sm border border-slate-200/50 transition-colors duration-500 ease-in-out">
                  <button 
                    (click)="toggleSugerencias()"
                    class="w-full flex items-center justify-between p-5 text-left focus:outline-none">
                    <div class="flex items-center gap-4">
                      <div class="w-8 h-8 rounded-full bg-white flex items-center justify-center shadow-sm text-purple-500">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg>
                      </div>
                      <span class="font-bold text-slate-800 text-lg">{{ config.detail.content.sections.suggestions.title }}</span>
                    </div>
                    <div class="w-8 h-8 rounded-full bg-white/50 flex items-center justify-center transition-all duration-500 ease-in-out"
                         [class.rotate-180]="isSugerenciasExpanded"
                         [class.bg-white]="isSugerenciasExpanded">
                      <svg class="w-5 h-5 text-slate-400 transition-colors duration-500 ease-in-out" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                      </svg>
                    </div>
                  </button>
                  <div 
                    class="overflow-hidden transition-all ease-in-out origin-top"
                    [class.duration-200]="!isSugerenciasExpanded"
                    [class.duration-500]="isSugerenciasExpanded"
                    [class.max-h-0]="!isSugerenciasExpanded"
                    [class.max-h-[2000px]]="isSugerenciasExpanded">
                    <div class="p-5 pt-0 pl-[4.5rem] text-slate-600 leading-relaxed transition-opacity ease-in-out" 
                         [class.duration-200]="!isSugerenciasExpanded"
                         [class.duration-500]="isSugerenciasExpanded"
                         [class.opacity-0]="!isSugerenciasExpanded"
                         [class.opacity-100]="isSugerenciasExpanded"
                         [innerHTML]="getSugerenciasHtml()"></div>
                  </div>
                </div>
              }
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Secciones Adicionales -->
    <app-group-trips-slider class="w-full"></app-group-trips-slider>
    <app-cta-section 
      class="w-full"
      [viajeNombre]="viaje.nombre"
      [viajePrecio]="formatearPrecio(viaje.valor)"
      [viajeDescripcion]="viaje.descripcion"
      [viajeFechas]="formatearRangoFechas(viaje.fechaInicio, viaje.fechaFin)">
    </app-cta-section>

  </div>
} @else {
  <div class="flex items-center justify-center min-h-screen bg-slate-50">
    <div class="text-center bg-white p-8 rounded-3xl shadow-xl max-w-md w-full mx-4">
      <div class="w-20 h-20 bg-red-50 rounded-full flex items-center justify-center mx-auto mb-6">
        <mat-icon class="text-red-500" style="font-size: 40px; width: 40px; height: 40px;">error_outline</mat-icon>
      </div>
      <h3 class="text-xl font-bold text-slate-900 mb-2">Lo sentimos</h3>
      <p class="text-slate-600 mb-8 leading-relaxed">{{ config.detail.error.message }}</p>
      <button mat-flat-button color="primary" (click)="volverAViajes()" class="!h-12 !px-8 !rounded-full !text-base">
        {{ config.detail.error.buttonText }}
      </button>
    </div>
  </div>
}
